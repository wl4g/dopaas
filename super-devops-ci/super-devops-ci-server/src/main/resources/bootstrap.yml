# Copyright (c) 2017 ~ 2025, the original author wangl.sir individual Inc,
# All rights reserved. Contact us <Wanglsir@gmail.com, 983708408@qq.com>
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# #### Spring cloud config server configuration. ####
#
spring:
  application.name: ci-server
  profiles:
    include: common,support,util
    active: dev
  cloud:
    devops:
      iam: # IAM client configuration.
        cors:
          enabled: true # Default: true
          rules:
            /**:
              allowsMethods: GET,POST
              allowsHeaders:
                - X-Iam-*
              allowCredentials: true
              allowsOrigins:
                #- '*'
        xss:
          enabled: true # Default: true
          expression: execution(* com.wl4g.devops.iam.common.*.*Controller.*(..)) or
                      execution(* com.wl4g.devops.iam.sns.*.*Controller.*(..)) or
                      execution(* com.wl4g.devops.iam.*.*Controller.*(..))
        client: # IAM client configuration.
          service-name: ${spring.application.name}
          use-remember-redirect: false
          filter-chain:
            /public/**: anon # Public rule release
            /hook/**: anon # Public rule release
      support:
        cli:
          enable: true
        notification:
          mail:
            enable: true # Default[false]
            properties:
              mail.smtp.auth: true
              mail.smtp.ssl.enable: true
              mail.smtp.timeout: 15000
              mail.smtp.starttls.enable: true
              mail.smtp.starttls.required: true
            templates: # http://www.bejson.com/convert/unicode_chinese
              tpl1: Application health notification：${appInfo} status changed from ${fromStatus} to ${toStatus}, details：${msg}
              tpl2: Your verification code is：${code} valid for 5 minutes. You can't tell anyone if you're dead. Thank you for using!
              tpl3: CI build ${isSuccess}, pipelineId is ${pipelineId}
          sms:
            enable: false # Default[false]
            aliyun:
              regionId: cn-hangzhou
              accessKeyId: LTAI4Fk9pjU7ezN2yVeiffYm
              accessKeySecret: {ALIYUN_SECRET}
              signName: Super Devops\u7edf\u4e00\u76d1\u63a7\u5e73\u53f0
              templates: # https://dysms.console.aliyun.com/dysms.htm#/domestic/text/template
                tpl1: SMS_140726862 # Alarm notice template.
                tpl2: SMS_109490228 # VerificationCode notice template.
                tpl3: CI build ${isSuccess}, pipelineId is ${pipelineId}
          vms:
            enable: false # Default[false]
            aliyun:
              regionId: cn-hangzhou
              accessKeyId: LTAI4Fk9pjU7ezN2yVeiffYm
              accessKeySecret: {ALIYUN_SECRET}
              calledShowNumber: 055162153866
              templates:
                tpl1: TTS_184825642 # Alarm notice template.
                tpl2: TTS_184820765 # VerificationCode notice template.
                tpl3: CI build ${isSuccess}, pipelineId is ${pipelineId}
  http: # Upload file limit
    multipart:
      max-file-size: 50Mb
      max-request-size: 50Mb

# ### Server configuration. ###
server:
  port: 14046
  #address: 0.0.0.0
  sessionTimeout: 30
  contextPath: /${spring.application.name}
  tomcat:
    uri-encoding: UTF-8
    protocolHeader: x-forwarded-proto
    remoteIpHeader: x-forwarded-for
    basedir: /tmp/${spring.application.name}
    access-log-enabled: false
    accesslog.directory: logs/
    backgroundProcessorDelay: 30 #seconds
    max-thread: 50 # Max worker threads(default:200).